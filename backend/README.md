# yaarxiv backend

# Features

- Auto parse the `schemas.json` (located at and generated by the api project) for model validation, faster serialization and deserialization, route specification, swagger generation.
- [nanoid](https://github.com/ai/nanoid) for user id generation
- [bcrypt](https://github.com/dcodeIO/bcrypt.js) to protect passwords

# Tools Used

- fastify
- typeorm
- TypeScript
- eslint

# Development

```bash
# Install dependencies
npm install

# Generate dev config
npm run generateConfig:dev

# Run migrations
npm run typeorm:cli migration:run

# Start
npm start

# When executing typeorm:cli, pass argument using -- as follows
npm run typeorm:cli migration:generate -- -n now
```

# Deployment

## Build

We use `webpack` to bundle the backend for simpler build and deployment and freedom from building API project separately.

```bash
# Clone the project (with the api project on the parent)

# Copy `config/production.sample.json` to `config/production.json` and change the configs
cp config/production.sample.json config/production.json
vim config/production.json

# Install dependencies
npm install

# Build
npm run build

```

## Built Assets

`dist` contains the following files which should be deployed to the production env.

```
.
├── config
│   ├── Config.d.ts
│   ├── default.json
│   └── env
│       └── production.json
├── db.db
├── migrations
├── ormconfig.js
├── out
│   └── bundle.js
├── package.json
├── tsconfig.json
└── upload
```

`scripts/copyAssets.ts` will copy the files above to the `dist` folder when building.

## Serve

On the folder with built assets shown above,

```bash
# Only install production dependencies
npm install --production


# Run!
npm run serve

```
